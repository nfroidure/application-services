[//]: # ( )
[//]: # (This file is automatically generated by the `jsarch`)
[//]: # (module. Do not change it elsewhere, changes would)
[//]: # (be overriden.)
[//]: # ( )
# Architecture Notes

## Summary

1. [Application services](#1-application-services)
   1. [`PROCESS_ENV`](#11-`process_env`)
      1. [Environment isolation](#111-environment-isolation)
      2. [`.env.node.${NODE_ENV}` files](#112-`.env.node.${node_env}`-files)
      3. [`.env.app.${APP_ENV}` files](#113-`.env.app.${app_env}`-files)
   2. [`PROJECT_DIR`](#12-`project_dir`)
   3. [`ENV`](#13-`env`)
   4. [`APP_CONFIG`](#14-`app_config`)
   5. [Process](#15-process)
      1. [Process name](#151-process-name)
      2. [Signals handling](#152-signals-handling)
      3. [Handling services fatal errors](#153-handling-services-fatal-errors)
      4. [Uncaught exceptions](#154-uncaught-exceptions)


## 1. Application services

This module manage application environments and configurations
 out of the box thanks to two separated environment variables:
 the classic `ENV.NODE_ENV` and the `APP_ENV`.

The `ENV.NODE_ENV` variable is intended to simply tell all
 tooling ecosystem in which context the code is run.

The `APP_ENV` is instead aimed to tell in which deployment
 environment the application is run (to load specific
 configurations like the databases endpoints of each
 deployment environments).

The `APP_ENV` values can be customized by overriding
 the AppEnv type in your own project:
```sh
cat "
import type {
  BaseAppEnv,
  BaseAppConfig,
  BaseAppEnvVars,
} from 'application-services';
import { DBConfig } from './services/db.js';

declare module 'application-services' {
  export interface AppEnvVars extends BaseAppEnvVars {
    DRY_RUN: string;
  }

  // Overriding with your application configurations
  export interface AppConfig
    extends BaseAppConfig,
    DBConfig {
      anyConfigPropYouWish: string;
    }
}
" > app.d.ts
```

[See in context](./src/index.ts#L1-L40)



### 1.1. `PROCESS_ENV`

A simple service to enclose the NodeJS `process.env`
 global variable. It is provided as a service to avoid
 the process environment to be saved into builds.

[See in context](./src/services/PROCESS_ENV.ts#L5-L10)



#### 1.1.1. Environment isolation

Per default, we take the process environment as is
 but since it could lead to leaks when building
 projects statically so one can isolate the process
 env by using the `ISOLATED_ENV` environment variable.

[See in context](./src/services/ENV.ts#L75-L80)



#### 1.1.2. `.env.node.${NODE_ENV}` files

You may want to set some env vars depending on the
 `NODE_ENV`. We use `dotenv` to provide your such
 ability.

[See in context](./src/services/ENV.ts#L104-L109)



#### 1.1.3. `.env.app.${APP_ENV}` files

You may need to keep some secrets out of your Git
 history fo each deployment targets too.

[See in context](./src/services/ENV.ts#L112-L115)



### 1.2. `PROJECT_DIR`

A service to determine the directory of the NodeJS project
 currently running.

[See in context](./src/services/PROJECT_DIR.ts#L7-L11)



### 1.3. `ENV`

The `ENV` service adds a layer of configuration over just using
 node's `process.env` value.

[See in context](./src/services/ENV.ts#L26-L30)



### 1.4. `APP_CONFIG`

The `APP_CONFIG` service allows to manage a typed application
 configuration by selectively loading the configuration file
 according to the `APP_ENV` environment variable.

[See in context](./src/services/APP_CONFIG.ts#L8-L13)



### 1.5. Process

The `process` service takes care of the process status.

It returns nothing and should be injected only for its
 side effects.

[See in context](./src/services/process.ts#L30-L35)



#### 1.5.1. Process name

It also set the process name with the actual NODE_ENV.

[See in context](./src/services/process.ts#L77-L80)



#### 1.5.2. Signals handling

It also handle SIGINT and SIGTERM signals to allow to
 gracefully shutdown the running process. The signals
 to handle can be customized by injecting the `SIGNALS`
 optional dependencies.

[See in context](./src/services/process.ts#L85-L91)



#### 1.5.3. Handling services fatal errors

If an error occurs it attempts to gracefully exit
to give it a chance to finish properly.

[See in context](./src/services/process.ts#L96-L100)



#### 1.5.4. Uncaught exceptions

If an uncaught exception occurs it also attempts to
 gracefully exit since a process should never be kept
 alive when an uncaught exception is raised.

[See in context](./src/services/process.ts#L107-L112)

